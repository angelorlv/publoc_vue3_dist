import Y from"./button.esm.yOU7mbBk.js";import Ae from"./togglebutton.esm.bayCMj70.js";import de from"./dropdown.esm.PA4Yd-8v.js";import Ie from"./checkbox.esm.4licMsu9.js";import{w as be,F as he,v as xe,i as ve,_ as ye,s as je,u as Me}from"./geosearch.JHL0My60.js";import{_ as pe}from"./_plugin-vue_export-helper.x3n3nnut.js";import{r as s,q as re,o as l,y as N,w as M,u as t,d as c,s as _e,h as q,a as e,F as H,A as ee,b as a,x as L,c as i,B as ge,C as $e,D as Z,e as Q,p as ke,f as we,E as ce,G as Re,H as Pe,I as Ee,J as ze,K as Ue,z as G,v as fe}from"./entry.sPeV4ugY.js";import Te from"./menu.esm.4ie6n-OE.js";import le from"./inputtext.esm.WOKXVyy7.js";import qe from"./image.esm.jznzKc00.js";import ae from"./dialog.esm.IuxdClzD.js";import{u as se}from"./useNotifToast.tXbUjrmB.js";import{u as ue}from"./global.JfHO2k1E.js";import Ne from"./textarea.esm.UY4JLWM7.js";import"./badge.esm.4D_NwcJ1.js";import"./basecomponent.esm.MS1ObfXz.js";import"./index.esm.8qzpe_dP.js";import"./baseicon.esm.7QbvKBS0.js";import"./index.esm.y5vHEM8V.js";import"./index.esm.ahttnF-b.js";import"./index.esm.zJBjtqpA.js";import"./index.esm.Rcv_evjR.js";import"./overlayeventbus.esm.r3x2PMkt.js";import"./portal.esm.HI47vqaC.js";import"./virtualscroller.esm.JbfppkDt.js";import"./index.esm.V7ce0zgG.js";const Oe={__name:"AdminMapView",props:["data_carte","old_lieu"],emits:["close","validate"],setup(p,{emit:E}){s({});const R=s([-18.929670491513264,47.52685546875001]);s("pk.eyJ1IjoiYW5nZWxvMTQyNyIsImEiOiJja3c0aGExMTIwNmp0Mm9udnY2bGNsZnRoIn0.PiJCKKLMoWzmULCaFs2CqA"),s({});const w=s(null);s({lat:0,lng:0,region:"",ville:"",quartier:"",pays:""}),s(["lat","lng","region","ville","quartier","pays"]);const v=s("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),d=s('&copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap</a> contributors');s([24,48]);const y=s(16);function o(){new be({provider:new he,showMarker:!1,style:"bar",notFoundMessage:"Désolé, l'Adresse n'a pas pus être trouvé",inputLabel:"sdfqsd"})}return re(()=>{o()}),(g,P)=>{const z=xe,_=ve,D=ye;return l(),N(D,null,{default:M(()=>[c(_,{ref_key:"map",ref:w,style:{"border-radius":"10px"},zoom:t(y),center:t(R)},{default:M(()=>[c(z,{url:t(v),attribution:t(d),options:{maxZoom:22,maxNativeZoom:18}},null,8,["url","attribution"])]),_:1},8,["zoom","center"])]),_:1})}}},Fe=pe(Oe,[["__scopeId","data-v-0809d28a"]]),Be={key:0,class:""},He={class:"flex border-b py-2 sticky top-0 bg-white"},Ze={class:"flex flex-col"},Je=e("span",{class:"text-sm"}," Etat ",-1),Ge=e("span",{class:"flex-grow"},null,-1),We={class:"flex flex-col ml-5"},Ke=e("span",{class:"text-sm"}," Date 1 ",-1),Qe={class:"flex flex-col ml-2"},Ye=e("span",{class:"text-sm"}," Date 2 ",-1),Xe={class:"flex flex-col"},et={class:"flex-grow flex justify-center items-center"},tt={key:0,class:"p-5 flex items-center justify-center"},st=e("span",{class:"text-sm text-gray-400"}," Pas d'historique disponible pour ce panneau ",-1),ot=[st],nt={key:1,class:""},lt={class:"py-2 border-b"},at={class:"flex flex-col p-2"},it={class:"flex flex-col"},ct=e("span",{class:"text-sm font-bold"}," Date de début de la location ",-1),dt={class:""},pt={class:"flex flex-col"},rt=e("span",{class:"text-sm font-bold"}," Nombre de Mois ",-1),_t={class:""},ut={class:"flex flex-col"},mt=e("span",{class:"text-sm font-bold"}," Date de Fin prévu de la location ",-1),ft={class:""},bt={key:0,class:"flex flex-col"},ht=e("span",{class:"text-sm font-bold"}," Date de fin de la location (manuelle) ",-1),xt={class:""},vt={class:"flex flex-col"},yt=e("span",{class:"text-sm font-bold"}," Etat ",-1),gt={class:""},$t={class:"flex flex-col"},kt=e("span",{class:"text-sm font-bold"}," Annonceur ",-1),wt={class:""},Dt={class:"text-xs text-gray-500"},Ct={__name:"AdminHistPanDispo",props:["visible","pan"],emits:["close"],setup(p,{emit:E}){const R=ue(),{prefix_api:w}=_e(R),{setErrorServer:v,setNotifToast:d}=se(),y=p,o=E,g=s([]),P=s(""),z=s([{label:"Tous",code:-1},{label:"Disponible",code:1},{label:"Location",code:3},{label:"Indisponible",code:4}]),_=s({1:"Dispo.",2:"En réservation",3:"En location",4:"Indispo."}),D=s(!1),S=s(null),V=s({}),u=s(null),f=s({dispOption:-1,date1:new Date().toLocaleDateString("en-CA"),date2:new Date().subMonths(12).toLocaleDateString("en-CA")});async function C(){try{const I=await $fetch(`${w.value}/a/ad/panel/hist-dispo/${y.pan.pan_id}`,{method:"get",query:f.value});I.status?(g.value=I.hists||[],u.value=I.dern):d({summary:"Récupération des historiques de disponibilité",detail:I.message,severity:"error"})}catch(I){console.error(I),v()}}async function A(I){try{const h=await $fetch(`${w.value}/a/ad/panel/hist-dispo/${I}/detail`);h.status?V.value=h.hist_infos:d({summary:"Infos sur l'historique de location",detail:h.message,severity:"error"})}catch(h){console.error(h),v()}}return q(()=>y.visible,I=>{I&&(P.value=`Historique de disponibilité du panneau ${y.pan.pan_ref} (${y.pan.pan_publoc_ref})`,D.value=!1,S.value=null,u.value=null,C())}),q(()=>f.value.date1,()=>{C()}),q(()=>f.value.date2,()=>{C()}),(I,h)=>{const x=de,n=le,j=Y,T=ae;return l(),N(T,{visible:p.visible,"onUpdate:visible":h[4]||(h[4]=$=>o("close")),maximizable:"",modal:"",header:t(P),style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:M(()=>[t(D)?(l(),i("div",nt,[e("div",lt,[c(j,{label:"Retour",onClick:h[3]||(h[3]=$=>D.value=!1),class:"p-button-sm p-1 p-button-danger",icon:"pi pi-arrow-left",text:""})]),e("div",at,[e("div",it,[ct,e("span",dt,a(new Date(t(V).pan_loc_date_debut).toLocaleDateString()),1)]),e("div",pt,[rt,e("span",_t,a(t(V).pan_loc_month),1)]),e("div",ut,[mt,e("span",ft,a(new Date(t(V).pan_loc_date_debut).addMonths(t(V).pan_loc_month).toLocaleDateString()),1)]),t(V).pan_loc_date_fin_validate?(l(),i("div",bt,[ht,e("span",xt,a(new Date(t(V).pan_loc_date_fin_validate).toLocaleDateString()),1)])):L("",!0),e("div",vt,[yt,e("span",gt,a(t(V).pan_loc_state==1?"En cours":"Términée"),1)]),e("div",$t,[kt,e("span",wt,[Q(a(t(V).ann_label)+" ",1),e("span",Dt,a(t(V).ann_is_agence_com?"( Agence de com. )":""),1)])])])])):(l(),i("div",Be,[e("div",He,[e("div",Ze,[Je,c(x,{options:t(z),modelValue:t(f).dispOption,"onUpdate:modelValue":h[0]||(h[0]=$=>t(f).dispOption=$),"option-value":"code","option-label":"label",class:"p-inputtext-sm"},null,8,["options","modelValue"])]),Ge,e("div",We,[Ke,c(n,{class:"p-inputtext-sm",type:"date",modelValue:t(f).date1,"onUpdate:modelValue":h[1]||(h[1]=$=>t(f).date1=$)},null,8,["modelValue"])]),e("div",Qe,[Ye,c(n,{class:"p-inputtext-sm",type:"date",modelValue:t(f).date2,"onUpdate:modelValue":h[2]||(h[2]=$=>t(f).date2=$)},null,8,["modelValue"])])]),e("div",Xe,[(l(!0),i(H,null,Z(t(g),($,O)=>$e((l(),i("div",{class:ee(["flex my-2 p-2 border rounded",{"border-blue-200":t(S)==$.panhist_id}]),key:$.panhist_id},[e("span",{class:ee(["border p-1 text-xs rounded flex justify-center items-center",{"bg-blue-500/20":$.panhist_pan_state==1||$.panhist_pan_state==2,"bg-red-500/20":$.panhist_pan_state==3,"bg-gray-500/20":$.panhist_pan_state==4}])},a(t(_)[$.panhist_pan_state]),3),e("div",et," De "+a(new Date($.panhist_date_debut).toLocaleDateString())+" à "+a(O-1<0?t(u)?new Date(t(u).panhist_date_debut).toLocaleDateString():"Aujourd'hui":new Date(t(g)[O-1].panhist_date_debut).toLocaleDateString()),1),$.panhist_pan_state==3?(l(),N(j,{key:0,label:"Détails",onClick:()=>{D.value=!0,S.value=$.panhist_id,A($.panhist_id)},class:"p-button-sm p-1 p-button-help",icon:"pi pi-arrow-right","icon-pos":"right",text:""},null,8,["onClick"])):L("",!0)],2)),[[ge,parseInt(t(f).dispOption)==-1||parseInt(t(f).dispOption)==$.panhist_pan_state]])),128)),t(g).length<=0?(l(),i("div",tt,ot)):L("",!0)])]))]),_:1},8,["visible","header"])}}},Vt={key:0,class:""},Lt={class:"flex border-b py-2 sticky top-0 bg-white"},St=e("span",{class:"flex-grow"},null,-1),At={class:"flex flex-col ml-5"},It=e("span",{class:"text-sm"}," Date 1 ",-1),jt={class:"flex flex-col ml-2"},Mt=e("span",{class:"text-sm"}," Date 2 ",-1),Rt={class:"flex flex-col"},Pt={class:"flex flex-col p-2 pr-5"},Et=e("span",{class:"text-sm font-bold"}," Etat ",-1),zt={class:"flex flex-col p-2 pr-5"},Ut=e("span",{class:"text-sm font-bold"}," Annonceur ",-1),Tt={class:""},qt={class:"flex flex-col p-2 pr-5"},Nt=e("span",{class:"text-sm font-bold"}," Sous Annonceur ",-1),Ot={class:""},Ft={class:"flex flex-col p-2 pr-5"},Bt=e("span",{class:"text-sm font-bold"}," Date de début ",-1),Ht={class:""},Zt={class:"flex flex-col p-2 pr-5"},Jt=e("span",{class:"text-sm font-bold"}," Mois ",-1),Gt={class:""},Wt={key:0,class:"flex flex-col p-2 pr-5"},Kt=e("span",{class:"text-sm font-bold"}," Date Fin (manuelle) ",-1),Qt={class:""},Yt={key:0,class:"p-5 flex items-center justify-center"},Xt=e("span",{class:"text-sm text-gray-400"}," Pas d'historique disponible pour ce panneau ",-1),es=[Xt],ts={key:1,class:""},ss={class:"py-2 border-b"},os={class:"flex flex-col p-2"},ns={class:"flex flex-col"},ls=e("span",{class:"text-sm font-bold"}," Date de début de la location ",-1),as={class:""},is={class:"flex flex-col"},cs=e("span",{class:"text-sm font-bold"}," Nombre de Mois ",-1),ds={class:""},ps={class:"flex flex-col"},rs=e("span",{class:"text-sm font-bold"}," Date de Fin prévu de la location ",-1),_s={class:""},us={key:0,class:"flex flex-col"},ms=e("span",{class:"text-sm font-bold"}," Date de fin de la location (manuelle) ",-1),fs={class:""},bs={class:"flex flex-col"},hs=e("span",{class:"text-sm font-bold"}," Etat ",-1),xs={class:""},vs={class:"flex flex-col"},ys=e("span",{class:"text-sm font-bold"}," Annonceur ",-1),gs={class:""},$s={class:"text-xs text-gray-500"},ks={__name:"AdminHistPanSousLoc",props:["visible","pan"],emits:["close"],setup(p,{emit:E}){const R=ue(),{prefix_api:w}=_e(R),{setErrorServer:v,setNotifToast:d}=se(),y=p,o=E,g=s([]),P=s(""),z=s(null),_=s(!1),D=s(null),S=s({}),V=s(null),u=s({date1:new Date().toLocaleDateString("en-CA"),date2:new Date().subMonths(12).toLocaleDateString("en-CA")});async function f(){try{const C=await $fetch(`${w.value}/a/ad/panel/hist-sous-location/${y.pan.pan_id}`,{method:"get",query:u.value});C.status?(g.value=C.hists||[],V.value=C.dern):d({summary:"Récupération des historiques de disponibilité",detail:C.message,severity:"error"})}catch(C){console.error(C),v()}}return q(()=>y.visible,C=>{C&&(P.value=`Historique de Sous location du panneau ${y.pan.pan_ref} (${y.pan.pan_publoc_ref})`,_.value=!1,D.value=null,V.value=null,z.value.maximized=!0,f())}),q(()=>u.value.date1,()=>{f()}),q(()=>u.value.date2,()=>{f()}),(C,A)=>{const I=le,h=Y,x=ae;return l(),N(x,{ref_key:"myDialog",ref:z,visible:p.visible,"onUpdate:visible":A[3]||(A[3]=n=>o("close")),maximizable:"",modal:"",header:t(P),style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:M(()=>[t(_)?(l(),i("div",ts,[e("div",ss,[c(h,{label:"Retour",onClick:A[2]||(A[2]=n=>_.value=!1),class:"p-button-sm p-1 p-button-danger",icon:"pi pi-arrow-left",text:""})]),e("div",os,[e("div",ns,[ls,e("span",as,a(new Date(t(S).pan_loc_date_debut).toLocaleDateString()),1)]),e("div",is,[cs,e("span",ds,a(t(S).pan_loc_month),1)]),e("div",ps,[rs,e("span",_s,a(new Date(t(S).pan_loc_date_debut).addMonths(t(S).pan_loc_month).toLocaleDateString()),1)]),t(S).pan_loc_date_fin_validate?(l(),i("div",us,[ms,e("span",fs,a(new Date(t(S).pan_loc_date_fin_validate).toLocaleDateString()),1)])):L("",!0),e("div",bs,[hs,e("span",xs,a(t(S).pan_loc_state==1?"En cours":"Términée"),1)]),e("div",vs,[ys,e("span",gs,[Q(a(t(S).ann_label)+" ",1),e("span",$s,a(t(S).ann_is_agence_com?"( Agence de com. )":""),1)])])])])):(l(),i("div",Vt,[e("div",Lt,[St,e("div",At,[It,c(I,{class:"p-inputtext-sm",type:"date",modelValue:t(u).date1,"onUpdate:modelValue":A[0]||(A[0]=n=>t(u).date1=n)},null,8,["modelValue"])]),e("div",jt,[Mt,c(I,{class:"p-inputtext-sm",type:"date",modelValue:t(u).date2,"onUpdate:modelValue":A[1]||(A[1]=n=>t(u).date2=n)},null,8,["modelValue"])])]),e("div",Rt,[(l(!0),i(H,null,Z(t(g),n=>(l(),i("div",{class:"flex border my-3 rounded-lg",key:n.saloc_id},[e("div",Pt,[Et,e("span",{class:ee(["border px-1 rounded-lg",{"border-green-500":n.saloc_loc_state==1}])},a(n.saloc_loc_state?"En cours":"Terminée"),3)]),e("div",zt,[Ut,e("span",Tt,a(n.ann_label),1)]),e("div",qt,[Nt,e("span",Ot,a(n.sous_ann_label),1)]),e("div",Ft,[Bt,e("span",Ht,a(new Date(n.saloc_date_debut).toLocaleDateString()),1)]),e("div",Zt,[Jt,e("span",Gt,a(n.saloc_month)+" ("+a(new Date(n.saloc_date_debut).addMonths(n.saloc_month).toLocaleDateString())+") ",1)]),n.saloc_date_fin_validate?(l(),i("div",Wt,[Kt,e("span",Qt,a(new Date(n.saloc_date_fin_validate).toLocaleDateString()),1)])):L("",!0)]))),128)),t(g).length<=0?(l(),i("div",Yt,es)):L("",!0)])]))]),_:1},8,["visible","header"])}}},ws=p=>(ke("data-v-8b06f3ae"),p=p(),we(),p),Ds={class:"w-screen h-screen bg-white bg-opacity-70 fixed top-0 left-0 flex justify-center items-center",style:{"z-index":"1010"}},Cs={class:"rounded-lg flex bg-gray-100",style:{height:"80%",width:"80%"}},Vs=ws(()=>e("div",{class:"p-0 m-0 relative flex justify-center items-end w-12 h-12",style:{}},[e("span",{class:"material-icons text-blue-600",style:{"font-size":"42px"}}," place ")],-1)),Ls={__name:"viewPanOnMap",props:["pan"],emits:["close"],setup(p,{emit:E}){const R=E;s({});const w=s([-18.929670491513264,47.52685546875001]);s("pk.eyJ1IjoiYW5nZWxvMTQyNyIsImEiOiJja3c0aGExMTIwNmp0Mm9udnY2bGNsZnRoIn0.PiJCKKLMoWzmULCaFs2CqA"),s({});const v=s(null);s(["lat","lng","region","ville","quartier","pays"]);const d=s("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),y=s('&copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap</a> contributors'),o=s([24,48]),g=s(16);function P(){new be({provider:new he,showMarker:!1,style:"bar",notFoundMessage:"Désolé, l'Adresse n'a pas pus être trouvé",inputLabel:"Rechercher un endroit"})}return re(()=>{P()}),(z,_)=>{const D=Y,S=xe,V=je,u=Me,f=ve,C=ye;return l(),i("div",Ds,[e("div",Cs,[c(D,{onClick:_[0]||(_[0]=A=>R("close")),icon:"pi pi-times",severity:"danger",rounded:"","aria-label":"Cancel",class:"fixed top-2 right-2 shadow-lg"}),c(C,null,{default:M(()=>[c(f,{ref_key:"map",ref:v,style:{"border-radius":"10px"},zoom:t(g),center:p.pan?[p.pan.lieu_lat,p.pan.lieu_lng]:t(w)},{default:M(()=>[c(S,{url:t(d),attribution:t(y),options:{maxZoom:22,maxNativeZoom:18}},null,8,["url","attribution"]),p.pan?(l(),N(u,{key:0,"lat-lng":[p.pan.lieu_lat,p.pan.lieu_lng],draggable:!1},{default:M(()=>[c(V,{"icon-anchor":t(o),"class-name":"someExtraClass"},{default:M(()=>[Vs]),_:1},8,["icon-anchor"])]),_:1},8,["lat-lng"])):L("",!0)]),_:1},8,["zoom","center"])]),_:1})])])}}},Ss=pe(Ls,[["__scopeId","data-v-8b06f3ae"]]),As={key:0,class:"flex flex-col"},Is=e("div",{class:""},[e("span",{class:""}," Le panneau est disponible ")],-1),js=[Is],Ms={key:1,class:"flex flex-col"},Rs=e("div",{class:"border-b"},[e("span",{class:""}," Le panneau est en location ")],-1),Ps={class:"p-2 flex justify-end"},Es={key:2,class:"flex flex-col"},zs=e("div",{class:""},[e("span",{class:""}," Le panneau n'est pas disponible ")],-1),Us=[zs],Ts={__name:"AdminChangeDispo",props:["visible","pan"],emits:["close"],setup(p,{emit:E}){const R=p,w=E;return q(()=>R.visible,v=>{}),(v,d)=>{const y=Y,o=ae;return l(),N(o,{visible:p.visible,"onUpdate:visible":d[0]||(d[0]=g=>w("close")),maximizable:"",modal:"",header:p.pan?`${p.pan.pan_publoc_ref} (${p.pan.pan_ref})`:"Modification de Panneau",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:M(()=>[p.pan.pan_state==1?(l(),i("div",As,js)):L("",!0),p.pan.pan_state==3?(l(),i("div",Ms,[Rs,e("div",Ps,[c(y,{label:"Annuler la location",class:"p-button-sm p-1 p-button-danger",icon:"pi pi-cog",text:""})])])):L("",!0),p.pan.pan_state==4?(l(),i("div",Es,Us)):L("",!0)]),_:1},8,["visible","header"])}}},qs={class:"flex flex-col my-3"},Ns={class:"flex items-end mb-3"},Os={key:0,class:"flex flex-col flex-grow"},Fs=e("span",{class:""}," Annonceur ",-1),Bs={class:"flex flex-col ml-2"},Hs=e("span",{class:""}," Nombre de Mois ",-1),Zs={class:"flex items-end"},Js={class:"flex flex-col flex-grow"},Gs=e("span",{class:""}," Début de la location ",-1),Ws={class:"flex flex-col ml-2 flex-grow"},Ks=e("span",{class:""}," Fin prévu de la location ",-1),Qs={class:"h-[40px] flex items-center justify-start px-2 border rounded"},Ys={class:"flex flex-col my-3"},Xs=e("span",{class:""}," Description de la location ",-1),eo={class:"mt-5 p-2 flex justify-end border-t"},to={__name:"AdminRentPanel",props:["visible","pan"],emits:["close","validate"],setup(p,{emit:E}){const R=ue(),{prefix_api:w}=_e(R),{setErrorServer:v,setNotifToast:d}=se(),y=p,o=E,g=s([]),P=s(!1),z=s(""),_=s({ann_id:-1,month:3,date_debut:new Date().toLocaleDateString("en-CA"),desc:""}),D=ce(()=>new Date(_.value.date_debut).addMonths(parseInt(_.value.month)).toLocaleDateString());async function S(){try{const u=await $fetch(`${w.value}/a/ad/panel/data-for-location/${y.pan.pan_id}`);u.status?(g.value=u.anns,g.value.length>0&&(_.value.ann_id=g.value[0].ann_id)):d({summary:"Récupération des données pour la location",detail:u.message,severity:"error"})}catch{v()}}async function V(){P.value=!0;try{const u=await $fetch(`${w.value}/a/ad/panel/rent/validate`,{method:"post",body:{pan_id:y.pan.pan_id,loc_pan:_.value}});u.status?(d({detail:"Location de panneau bien effectué",summary:"Location de panneau",severity:"info"}),o("validate"),o("close")):d({detail:u.message,summary:"Location de panneau",severity:"error"})}catch{v()}P.value=!1}return q(()=>y.visible,u=>{u&&(z.value=`Location du panneau ${y.pan.pan_ref} (${y.pan.pan_publoc_ref})`,S())}),(u,f)=>{const C=de,A=le,I=Ne,h=Y,x=ae;return l(),N(x,{visible:p.visible,"onUpdate:visible":f[4]||(f[4]=n=>o("close")),maximizable:"",modal:"",header:t(z),style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:M(()=>[e("div",qs,[e("div",Ns,[t(g).length>0?(l(),i("div",Os,[Fs,c(C,{class:"p-inputtext-sm",filter:"",modelValue:t(_).ann_id,"onUpdate:modelValue":f[0]||(f[0]=n=>t(_).ann_id=n),options:t(g),"option-label":"ann_label","option-value":"ann_id"},null,8,["modelValue","options"])])):L("",!0),e("div",Bs,[Hs,c(A,{type:"number",modelValue:t(_).month,"onUpdate:modelValue":f[1]||(f[1]=n=>t(_).month=n),class:"p-inputtext-sm"},null,8,["modelValue"])])]),e("div",Zs,[e("div",Js,[Gs,c(A,{type:"date",modelValue:t(_).date_debut,"onUpdate:modelValue":f[2]||(f[2]=n=>t(_).date_debut=n),class:"p-inputtext-sm"},null,8,["modelValue"])]),e("div",Ws,[Ks,e("span",Qs,a(t(D)),1)])])]),e("div",Ys,[Xs,c(I,{modelValue:t(_).desc,"onUpdate:modelValue":f[3]||(f[3]=n=>t(_).desc=n),class:"p-inputtext-sm"},null,8,["modelValue"])]),e("div",eo,[c(h,{class:"p-button-sm",label:"Valider la location",onClick:V,icon:"pi pi-check"})])]),_:1},8,["visible","header"])}}},so={class:"bg-white fixed w-screen h-screen top-0 left-0 z-[900] overflow-auto"},oo={key:0,class:"md:w-[900px] w-[100%] mx-auto flex flex-col"},no={class:"flex border p-2 my-5"},lo={class:"flex flex-col"},ao=e("span",{class:"text-sm font-bold"}," Réf. Publoc ",-1),io={class:""},co={class:"flex flex-col ml-5"},po=e("span",{class:"text-sm font-bold"}," Réf. Régissseur ",-1),ro={class:""},_o={class:"flex flex-col ml-5"},uo=e("span",{class:"text-sm font-bold"}," Régissseur ",-1),mo={class:""},fo={class:"flex border mb-5 p-2"},bo={class:"flex flex-col"},ho=e("span",{class:"text-sm font-bold"}," Catégorie ",-1),xo={class:""},vo={class:"flex flex-col ml-5"},yo=e("span",{class:"text-sm font-bold"}," Format ",-1),go={class:""},$o={class:"flex border mb-5 flex-col"},ko={class:"p-1 border-b border-dashed flex items-center"},wo={class:"text-sm font-bold uppercase underline-text"},Do=e("span",{class:"flex-grow"},null,-1),Co={class:"flex w-full justify-end items-center"},Vo={key:0,class:"w-full"},Lo=e("div",{class:"p-1 border-b border-dashed"},[e("span",{class:"text-sm font-bold uppercase underline-text-purple"}," Ce panneau est disponible ")],-1),So={class:"p-2 flex justify-end"},Ao={key:1,class:"w-full border border-red-400"},Io=e("div",{class:"p-1 border-b border-dashed"},[e("span",{class:"text-sm font-bold underline-text-purple uppercase"}," Ce panneau est en location ")],-1),jo={key:0,class:"flex flex-col p-2 w-full"},Mo={class:"flex flex-col"},Ro=e("span",{class:"text-sm font-bold"}," Date de début de la location ",-1),Po={class:""},Eo={class:"flex flex-col"},zo=e("span",{class:"text-sm font-bold"}," Nombre de Mois ",-1),Uo={class:""},To={class:"flex flex-col"},qo=e("span",{class:"text-sm font-bold"}," Date Fin prévu de la location ",-1),No={class:""},Oo={class:"flex flex-col border p-2 bg-red-200/5"},Fo={class:"flex items-center"},Bo={class:"flex flex-col"},Ho=e("span",{class:"text-sm font-bold"}," Annonceur ",-1),Zo={class:""},Jo={class:"text-xs text-gray-500"},Go={key:0,class:"flex flex-col mt-2"},Wo=e("div",{class:"border-b border-dashed flex items-center"},[e("span",{class:"text-sm font-bold uppercase underline-text-purple"}," Sous-location ")],-1),Ko={class:"flex flex-col"},Qo={class:"flex flex-col"},Yo=e("span",{class:"text-sm font-bold"}," Annonceur ",-1),Xo={class:""},en={class:"flex flex-col"},tn=e("span",{class:"text-sm font-bold"}," Date de début ",-1),sn={class:""},on={class:"flex flex-col"},nn=e("span",{class:"text-sm font-bold"}," Nombre de mois ",-1),ln={class:""},an={class:"flex flex-col"},cn=e("span",{class:"text-sm font-bold"}," Date prévu de la fin de la sous-location ",-1),dn={class:""},pn={class:"flex justify-end p-2 py-5"},rn={key:0,class:"p-2 flex justify-end border-t border-dashed mt-2"},_n={key:1,class:"p-2"},un=e("span",{class:"text-sm"}," Les infos de la location ne sont pas disponible ",-1),mn=[un],fn={key:2,class:"w-full"},bn=e("div",{class:"p-1 border-b border-dashed"},[e("span",{class:"text-sm font-bold underline-text-purple uppercase"}," Ce panneau n'est pas disponible ")],-1),hn={class:"p-2 flex justify-end"},xn={class:"flex flex-col border mb-5"},vn={class:"border-b border-dashed p-1 flex items-center"},yn=e("span",{class:"font-bold text-sm"}," Emplacement ",-1),gn=e("span",{class:"flex-grow"},null,-1),$n={class:"flex flex-col p-2"},kn={class:"flex flex-col mb-2"},wn=e("span",{class:"text-sm font-bold"}," Lieu dit ",-1),Dn={class:""},Cn={class:"flex flex-col mb-2"},Vn=e("span",{class:"text-sm font-bold"}," Ville ",-1),Ln={class:""},Sn={class:"flex flex-col mb-2"},An=e("span",{class:"text-sm font-bold"}," Région ",-1),In={class:""},jn={class:"flex flex-col mb-2"},Mn=e("span",{class:"text-sm font-bold"}," Quartier ",-1),Rn={class:""},Pn={class:"flex flex-col border mb-5"},En=e("div",{class:"border-b border-dashed p-1"},[e("span",{class:"font-bold text-sm"}," Images en mode Disponible ")],-1),zn={key:0,class:"flex flex-wrap p-2"},Un=e("i",{class:"pi pi-search"},null,-1),Tn=["src"],qn=["src","onClick"],Nn={key:1,class:"flex justify-center items-center p-5"},On=e("span",{class:"font-bold text-gray-500"}," Aucune photo en mode dispo ",-1),Fn=[On],Bn={class:"flex flex-col border mb-5"},Hn=e("div",{class:"border-b border-dashed p-1"},[e("span",{class:"font-bold text-sm"}," Images en mode pose ")],-1),Zn={key:0,class:"flex flex-wrap p-2"},Jn=e("i",{class:"pi pi-search"},null,-1),Gn=["src"],Wn=["src","onClick"],Kn={key:1,class:"flex justify-center items-center p-5"},Qn=e("span",{class:"font-bold text-gray-500"}," Aucune photo en mode pose ",-1),Yn=[Qn],Xn={class:"flex flex-col border mb-5"},el=e("div",{class:"border-b border-dashed p-1"},[e("span",{class:"font-bold text-sm"}," Images Solarpro ")],-1),tl={key:0,class:"flex flex-wrap p-2"},sl=e("i",{class:"pi pi-search"},null,-1),ol=["src"],nl=["src","onClick"],ll={key:1,class:"flex justify-center items-center p-5"},al=e("span",{class:"font-bold text-gray-500"}," Aucune photo Solarpro ",-1),il=[al],cl={class:"p-2 flex mb-5 border-t"},dl=e("span",{class:"flex-grow"},null,-1),pl={__name:"AdminViewPanel",props:["visible","pan_id","prefix_api"],emits:["close","refresh"],setup(p,{emit:E}){const{setErrorServer:R,setNotifToast:w}=se();Re(),Pe();const v=p,d=E,y=Ee(),o=s({}),g=s(!1),P=s(!1),z=s(!1),_=s(!1),D=s(!1),S=()=>{y.require({group:"templating",header:"Suppression Panneau",message:"<strong >Voulez-vous vraiment supprimer ce panneau ?</strong> Le Panneau sera placé dans un corbeille.",icon:"pi pi-exclamation-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",rejectClass:"p-button-outlined p-button-sm",acceptClass:"p-button-sm",rejectLabel:"Annuler",acceptLabel:"Oui",position:"bottom",accept:()=>{A()},reject:()=>{}})},V=()=>{y.require({group:"templating",header:"Annulation de Sous-location",message:"<div>Voulez-vous vraiment <strong> annuler la sous-location </strong> ? </div>",icon:"pi pi-exclamation-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",rejectClass:"p-button-outlined p-button-sm",acceptClass:"p-button-sm",rejectLabel:"Annuler",acceptLabel:"Oui",position:"bottom",accept:()=>{f()},reject:()=>{}})},u=x=>{if(o.value.pan.sous_ann_id){w({detail:"Le panneau a une sous-location ! Veuillez annuler la sous-location avant de changer de disponibilité."});return}y.require({group:"templating",header:"Changement de disponibilité",message:`<span>Voulez-vous vraiment mettre ce panneau en ${x=="dispo"?"disponible":"Indisponible"} ?</span>
        <span class="font-bold">${o.value.pan.pan_state==3?"La location sera annulée.":""}</span>
        `,icon:"pi pi-exclamation-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",rejectClass:"p-button-outlined p-button-sm",acceptClass:"p-button-sm",rejectLabel:"Annuler",acceptLabel:"Oui",position:"bottom",accept:()=>{C(x)},reject:()=>{}})};async function f(){try{const x=await $fetch(`${v.prefix_api}/a/ad/panel/${o.value.pan.pan_id}/sous-loc`,{method:"delete"});x.status?(d("refresh"),h(),w({detail:"Sous-location bien annulée.",summary:"Annulation de sous-location",severity:"success"})):w({detail:x.message,summary:"Annulation de sous-location",severity:"success"})}catch{R()}}async function C(x){try{const n=await $fetch(`${v.prefix_api}/a/ad/panel/change-dispo`,{method:"put",body:{to:x,pan_id:o.value.pan.pan_id}});n.status?(w({detail:"Changement de disponibilité réussi.",summary:"Changement de disponibilité",severity:"info"}),h(),d("refresh")):w({detail:n.message,summary:"Changement de disponibilité",severity:"error"})}catch{R()}}async function A(){try{const x=await $fetch(`${v.prefix_api}/a/ad/panel/${v.pan_id}`,{method:"delete"});x.status?(w({summary:"Suppression d'un panneau",detail:"Le panneau est placé dans la corbeille 🧺"}),d("refresh"),d("close")):w({detail:x.message,severity:"error",summary:"Suppression d'un panneau"})}catch{R()}}function I(){window.open(`/admin/panels/modif?id=${v.pan_id}`,"_blank")}async function h(){try{const x=await $fetch(`${v.prefix_api}/a/ad/panel/${v.pan_id}`,{method:"get"});x.status?(o.value=x.pan_infos,o.value.loc_infos&&(o.value.loc_infos.date_fin=new Date(o.value.loc_infos.pan_loc_date_debut).addMonths(o.value.loc_infos.pan_loc_month)),o.value.sous_loc_infos&&(o.value.sous_loc_infos.date_fin=new Date(o.value.sous_loc_infos.saloc_date_debut).addMonths(o.value.sous_loc_infos.saloc_month))):w({summary:"Récupération des données",detail:x.message,severity:"error"})}catch(x){console.error(x),R()}}return ze((x,n)=>(d("close"),!1)),Ue(()=>{h()}),(x,n)=>{const j=Y,T=qe,$=Ct,O=ks,te=Ss,oe=Ts,J=to;return l(),i("div",so,[c(j,{onClick:n[0]||(n[0]=b=>d("close")),icon:"pi pi-times",severity:"danger",rounded:"","aria-label":"Cancel",class:"fixed top-2 right-2 shadow-lg"}),t(o).pan?(l(),i("div",oo,[e("div",no,[e("div",lo,[ao,e("span",io,a(t(o).pan.pan_publoc_ref),1)]),e("div",co,[po,e("span",ro,a(t(o).pan.pan_ref),1)]),e("div",_o,[uo,e("span",mo,a(t(o).pan.reg_label),1)])]),e("div",fo,[e("div",bo,[ho,e("span",xo,a(t(o).pan.category_label||"-"),1)]),e("div",vo,[yo,e("span",go,a(t(o).pan.format_label||"-"),1)])]),e("div",$o,[e("div",ko,[e("span",wo,a("disponibilité".toUpperCase()),1),Do,e("div",Co,[c(j,{label:"Historique de disponibilité",onClick:n[1]||(n[1]=b=>P.value=!0),class:"p-button-sm p-1 p-button-help mr-5",icon:"pi pi-history",text:""}),c(j,{label:"Historique de sous location",onClick:n[2]||(n[2]=b=>z.value=!0),class:"p-button-sm p-1 p-button-help",icon:"pi pi-history",text:""})])]),t(o).pan.pan_state==1?(l(),i("div",Vo,[Lo,e("div",So,[c(j,{onClick:n[3]||(n[3]=b=>u("indispo")),label:"Rendre Indisponible",class:"p-button-sm p-1 p-button-danger mr-5",icon:"pi pi-times",text:""}),c(j,{label:"Louer le panneau",onClick:n[4]||(n[4]=b=>D.value=!0),class:"p-button-sm p-1 p-button-help",icon:"pi pi-cog",text:""})])])):t(o).pan.pan_state==3?(l(),i("div",Ao,[Io,t(o).loc_infos!=null?(l(),i("div",jo,[e("div",Mo,[Ro,e("span",Po,a(new Date(t(o).loc_infos.pan_loc_date_debut).toLocaleDateString()),1)]),e("div",Eo,[zo,e("span",Uo,a(t(o).loc_infos.pan_loc_month),1)]),e("div",To,[qo,e("span",No,a(t(o).loc_infos.date_fin.toLocaleDateString()),1)]),e("div",Oo,[e("div",Fo,[e("div",Bo,[Ho,e("span",Zo,[Q(a(t(o).pan.ann_label||"-")+" ",1),e("span",Jo,a(t(o).pan.ann_is_agence_com?"( Agence de com. )":""),1)])])]),t(o).pan.sous_ann_id?(l(),i("div",Go,[Wo,e("div",Ko,[e("div",Qo,[Yo,e("span",Xo,a(t(o).pan.sous_ann_label),1)]),e("div",en,[tn,e("span",sn,a(new Date(t(o).sous_loc_infos.saloc_date_debut).toLocaleDateString()),1)]),e("div",on,[nn,e("span",ln,a(t(o).sous_loc_infos.saloc_month),1)]),e("div",an,[cn,e("span",dn,a(t(o).sous_loc_infos.date_fin.toLocaleDateString()),1)]),e("div",pn,[c(j,{label:"Annuler la sous-location",onClick:V,class:"p-button-sm p-1 p-button-danger mr-5",icon:"pi pi-times",text:""})])])])):L("",!0)]),t(o).pan.sous_ann_id?L("",!0):(l(),i("div",rn,[c(j,{onClick:n[5]||(n[5]=b=>u("indispo")),label:"Rendre Indisponible",class:"p-button-sm p-1 p-button-danger mr-5",icon:"pi pi-times",text:""}),c(j,{onClick:n[6]||(n[6]=b=>u("dispo")),label:"Rendre Disponible",class:"p-button-sm p-1 p-button-info",icon:"pi pi-times",text:""})]))])):(l(),i("div",_n,mn))])):t(o).pan.pan_state==4?(l(),i("div",fn,[bn,e("div",hn,[c(j,{onClick:n[7]||(n[7]=b=>u("dispo")),label:"Rendre disponible",class:"p-button-sm p-1 p-button-info mr-5",icon:"pi pi-times",text:""}),c(j,{label:"Louer le panneau",onClick:n[8]||(n[8]=b=>D.value=!0),class:"p-button-sm p-1 p-button-help",icon:"pi pi-cog",text:""})])])):L("",!0)]),e("div",xn,[e("div",vn,[yn,gn,c(j,{label:"Voir la carte",class:"p-button-sm p-1",icon:"pi pi-map-marker",text:"",onClick:n[9]||(n[9]=b=>g.value=!0)})]),e("div",$n,[e("div",kn,[wn,e("span",Dn,a(t(o).pan.lieu_label),1)]),e("div",Cn,[Vn,e("span",Ln,a(t(o).pan.lieu_ville),1)]),e("div",Sn,[An,e("span",In,a(t(o).pan.lieu_region||"-"),1)]),e("div",jn,[Mn,e("span",Rn,a(t(o).pan.lieu_quartier||"-"),1)])])]),e("div",Pn,[En,t(o).photo_dispo?(l(),i("div",zn,[(l(!0),i(H,null,Z(t(o).photo_dispo,b=>(l(),N(T,{key:b.file_id,class:"mr-2 mb-2",alt:"Image",preview:""},{indicatoricon:M(()=>[Un]),image:M(()=>[e("img",{src:`/api/p/media/${b.name_min_file}`,alt:"image",width:"100"},null,8,Tn)]),preview:M(F=>[e("img",{src:`/api/p/media/${b.name_file}`,alt:"preview",style:G(F.style),onClick:F.onClick},null,12,qn)]),_:2},1024))),128))])):(l(),i("div",Nn,Fn))]),e("div",Bn,[Hn,t(o).photo_pose?(l(),i("div",Zn,[(l(!0),i(H,null,Z(t(o).photo_pose,b=>(l(),N(T,{key:b.file_id,class:"mr-2 mb-2",alt:"Image",preview:""},{indicatoricon:M(()=>[Jn]),image:M(()=>[e("img",{src:`/api/p/media/${b.name_min_file}`,alt:"image",width:"100"},null,8,Gn)]),preview:M(F=>[e("img",{src:`/api/p/media/${b.name_file}`,alt:"preview",style:G(F.style),onClick:F.onClick},null,12,Wn)]),_:2},1024))),128))])):(l(),i("div",Kn,Yn))]),e("div",Xn,[el,t(o).photo_solarpro?(l(),i("div",tl,[(l(!0),i(H,null,Z(t(o).photo_solarpro,b=>(l(),N(T,{key:b.file_id,class:"mr-2 mb-2",alt:"Image",preview:""},{indicatoricon:M(()=>[sl]),image:M(()=>[e("img",{src:`/api/p/media/${b.name_min_file}`,alt:"image",width:"100"},null,8,ol)]),preview:M(F=>[e("img",{src:`/api/p/media/${b.name_file}`,alt:"preview",style:G(F.style),onClick:F.onClick},null,12,nl)]),_:2},1024))),128))])):(l(),i("div",ll,il))]),e("div",cl,[c(j,{onClick:h,label:"Actualiser",icon:"pi pi-refresh",class:"mr-5 p-button-sm p-button-help",outlined:""}),dl,c(j,{onClick:I,label:"Modifier",icon:"pi pi-pencil",class:"mr-5 p-button-sm"}),c(j,{class:"p-button-sm",onClick:n[10]||(n[10]=b=>S()),severity:"danger",label:"Supprimer",icon:"pi pi-times",outlined:""})])])):L("",!0),c($,{visible:t(P),onClose:n[11]||(n[11]=b=>P.value=!1),pan:t(o).pan},null,8,["visible","pan"]),c(O,{visible:t(z),onClose:n[12]||(n[12]=b=>z.value=!1),pan:t(o).pan},null,8,["visible","pan"]),t(g)?(l(),N(te,{key:1,onClose:n[13]||(n[13]=b=>g.value=!1),pan:t(o).pan},null,8,["pan"])):L("",!0),c(oe,{pan:t(o).pan,onClose:n[14]||(n[14]=b=>_.value=!1),visible:t(_)},null,8,["pan","visible"]),c(J,{pan:t(o).pan,visible:t(D),onClose:n[15]||(n[15]=b=>D.value=!1),onValidate:n[16]||(n[16]=()=>{h(),d("refresh")})},null,8,["pan","visible"])])}}},W=p=>(ke("data-v-52c83248"),p=p(),we(),p),rl={class:"h-full overflow-auto flex-grow flex flex-col"},_l={class:"flex-grow flex justify-center items-center"},ul={class:"flex items-end justify-center"},ml={class:"border border-purple-500 rounded p-2 mr-5 min-w-[150px] text-center bg-white"},fl={class:"border rounded p-2 mr-5 min-w-[150px] text-center bg-white"},bl={class:"border rounded p-2 mr-5 w-[150px] text-center bg-white"},hl={class:"flex flex-col"},xl=W(()=>e("span",{class:"text-xs font-bold"}," Page ",-1)),vl={key:0,class:"flex flex-col text-sm"},yl={class:""},gl={class:""},$l={class:"text-center border"},kl=["onClick"],wl={key:1,class:"flex flex-col"},Dl={key:0,class:"text-xs text-gray-500"},Cl=W(()=>e("strong",null," Sous-location ",-1)),Vl={key:2,class:"flex"},Ll={class:"text-xs border px-1 w-[30px]"},Sl={class:"ml-2"},Al={key:3,class:""},Il={key:1,class:"p-2 border-b"},jl={class:"h-full w-full"},Ml=W(()=>e("div",{class:"w-[400px] p-2"},[e("span",{class:""}," Ici affichage des infos sur le panneaux sélectionné ")],-1)),Rl={key:2,class:"bg-gray-50 min-h-[50px] items-center flex border-t w-full sticky bottom-0 justify-center"},Pl={class:"px-5"},El=W(()=>e("span",{class:"underline-text"}," Sélections :",-1)),zl={class:"underline-text-purple font-bold text-xl"},Ul={class:"ml-2"},Tl={class:"flex items-center p-2 bg-gray-50 sticky top-0 z-50"},ql={key:0,class:"uppercase font-bold flex-grow text-center"},Nl={class:"flex flex-col px-2"},Ol={class:"flex flex-col mb-2 border-b py-2"},Fl=W(()=>e("span",{class:"text-xs font-bold"}," Etat ",-1)),Bl={class:"flex justify-end p-2 border-b mb-2"},Hl={class:"my-5 flex flex-col"},Zl=W(()=>e("span",{class:"text-xs"}," Condition de recherche ",-1)),Jl={class:"flex justify-end"},Gl={class:"flex flex-col"},Wl=W(()=>e("span",{class:"text-xs font-bold"}," Rechercher ",-1)),Kl={class:"flex flex-col"},Ql=W(()=>e("span",{class:"text-xs font-bold"}," Par ",-1)),Yl={__name:"index",props:["heightHeader","prefix_api","heightContainer"],setup(p){const E=p,{setErrorServer:R,setNotifToast:w}=se(),v=s([]),d=s({limit:150,page:1,state:"all",condition:"and"}),y=s({1:"Dispo.",2:"En réservation",3:"En location",4:"Indispo."}),o=s(!1),g=s(60),P=s([{label:"Ref. Régisseur",key:"pan_ref",w:50},{label:"Ref. Publoc",key:"pan_publoc_ref",w:50},{label:"Régisseur",key:"reg_label"},{label:"Annonceur",key:"ann_label"},{label:"Catégorie",key:"category_label"},{label:"Format",key:"format_label"},{label:"Etat",key:"state"}]),z=s([{label:"ET",key:"and"},{label:"OU",key:"or"}]);s([]);const _=s({}),D=s(!1);q(()=>D.value,m=>{S()}),q(()=>o.value,async m=>{m?d.value.limit=1e4:(v.value=[],d.value.limit=150),await K()});function S(){if(D.value)for(let m=0;m<v.value.length;m++){const k=v.value[m];_.value[k.pan_id]=!0}else V()}function V(){const m=Object.keys(_.value);for(let k=0;k<m.length;k++){const B=m[k];delete _.value[B]}}const u=ce(()=>{const m=Object.keys(_.value);return f(m,_.value)});function f(m,k){return m.reduce((ne,X)=>k[X]?ne+1:ne,0)}const C=s(!1),A=s(null),I=s(),h=s([{label:"Options",items:[{label:"Louer les panneaux",icon:"pi pi-refresh"},{label:"Export",icon:"pi pi-upload"}]}]),x=m=>{I.value.toggle(m)},n=s([{label:"Ref. Régisseur",key:"pan_ref"},{label:"Ref. Publoc",key:"pan_publoc_ref"},{label:"Régisseur",key:"reg"},{label:"Annonceur",key:"ann"},{label:"Sous Annonceur",key:"sous_ann"},{label:"Ville",key:"ville"},{label:"Quartier",key:"quartier"},{label:"Lieu dit",key:"lieu_label"},{label:"Catégorie",key:"cat"},{label:"Format",key:"format"}]);s([]),s([]);const j=s([{label:"Tous",key:"all"},{label:"Dispo",key:"1"},{label:"En réservation",key:"2"},{label:"En Location",key:"3"},{label:"Indisponible",key:"4"}]),T=s([{search:"",search_by:"pan_ref",id:1}]),$=s(300),O=s(!0);s("pan_publoc_ref"),q(O,m=>{$.value=m?300:50}),q(T.value,m=>{d.value.page=1,K()}),q(()=>d.value.condition,()=>{K()}),q(()=>d.value.state,()=>{d.value.page=1,K()});const te=s(!1),oe=s(0),J=s(0),b=ce(()=>{const m=Math.ceil(J.value/d.value.limit);return J.value>0?Array.from({length:m},(k,B)=>B+1):[1]});function F(){const m=T.value[T.value.length-1];T.value.push({search:"",search_by:"pan_ref",id:m.id+1})}function De(m){T.value.splice(m,1)}async function K(){te.value=!0,V();try{const m=await $fetch(`${E.prefix_api}/a/ad/panels`,{method:"get",query:{filters:d.value,search_filters:T.value}});m.status?(v.value=m.panels,oe.value=m.nb_total_panel,J.value=m.nb_total_resultat):w({severity:"error",detail:m.message,summary:"récupération des Liste des panneaux"})}catch(m){console.error(m),R()}te.value=!1}return re(()=>{K()}),(m,k)=>{const B=Y,ne=Ae,X=de,me=Ie,Ce=Fe,Ve=Te,Le=le,Se=pl;return l(),i("div",{class:"flex h-full overflow-auto",style:G({height:`${E.heightContainer}px`})},[e("div",rl,[e("div",{class:"border-b sticky flex items-center top-0 bg-gray-50 px-2 z-50",style:G({minHeight:`${t(g)}px`})},[c(B,{loading:t(te),icon:"pi pi-refresh ",onClick:K,class:"p-button-sm p-1 p-button-text p-button-help",label:"Actualiser"},null,8,["loading"]),e("div",_l,[c(ne,{modelValue:t(o),"onUpdate:modelValue":k[0]||(k[0]=r=>fe(o)?o.value=r:null),onLabel:"Voir la liste",offLabel:"Voir la carte",onIcon:"pi pi-list",offIcon:"pi pi-map",class:"w-9rem","aria-label":"Afficher la carte"},null,8,["modelValue"])]),e("div",ul,[e("div",ml,[Q(" Total Résultat : "),e("strong",null,a(t(J)),1)]),e("div",fl,[Q(" Total Panneau : "),e("strong",null,a(t(oe)),1)]),e("div",bl,[e("strong",null,a((t(d).page-1)*t(d).limit+1),1),Q(" à "),e("strong",null,a(t(d).page*t(d).limit>t(J)?t(J):t(d).page*t(d).limit),1)]),e("div",hl,[xl,c(X,{class:"p-0 p-inputtext-sm text-xs",options:t(b),modelValue:t(d).page,"onUpdate:modelValue":k[1]||(k[1]=r=>t(d).page=r)},null,8,["options","modelValue"])])])],4),t(o)?L("",!0):(l(),i("div",vl,[e("table",yl,[e("thead",gl,[e("tr",{class:"bg-gray-50 sticky z-50",style:G({top:`${t(g)}px`})},[e("th",null,[c(me,{binary:!0,modelValue:t(D),"onUpdate:modelValue":k[2]||(k[2]=r=>fe(D)?D.value=r:null)},null,8,["modelValue"])]),(l(!0),i(H,null,Z(t(P),r=>(l(),i("th",{class:"border-x uppercase text-left px-2",style:{},key:r.key},a(r.label),1))),128))],4)]),e("tbody",null,[(l(!0),i(H,null,Z(t(v),(r,ie)=>(l(),i("tr",{class:ee([{"bg-green-200/20":t(_)[r.pan_id]&&r.pan_id!=t(A),"bg-purple-300/30":t(A)==r.pan_id},""]),key:r.pan_id},[e("td",$l,[c(me,{modelValue:t(_)[r.pan_id],"onUpdate:modelValue":U=>t(_)[r.pan_id]=U,binary:!0},null,8,["modelValue","onUpdate:modelValue"])]),(l(!0),i(H,null,Z(t(P),U=>(l(),i("td",{class:ee([{"underline cursor-pointer":U.key=="pan_ref"},"border p-2"]),onClick:()=>{U.key=="pan_ref"&&(C.value=!0,A.value=r.pan_id)},key:U.key},[U.key=="state"?(l(),i("span",{key:0,class:ee(["border p-1 text-xs",{"bg-blue-500/20":r.pan_state==1||r.pan_state==2,"bg-red-500/20":r.pan_state==3,"bg-gray-500/20":r.pan_state==4}])},a(t(y)[r.pan_state]),3)):U.key=="ann_label"?(l(),i("span",wl,[e("span",null,a(r[U.key]),1),r.sous_ann_id?(l(),i("span",Dl,[Cl,Q(" : "+a(r.sous_ann_label),1)])):L("",!0)])):U.key=="pan_ref"?(l(),i("div",Vl,[e("span",Ll,a(((t(d).page-1)*t(d).limit+1+ie).toString().padStart(4,0)),1),e("span",Sl,a(r.pan_ref),1)])):(l(),i("span",Al,a(r[U.key]||"-"),1))],10,kl))),128))],2))),128))])])])),t(o)?(l(),i("div",Il,[e("div",{class:"flex",style:G(`height:${p.heightContainer-p.heightHeader-16}px`)},[e("div",jl,[c(Ce)]),Ml],4)])):L("",!0),!t(o)&&t(u)>0?(l(),i("div",Rl,[e("div",Pl,[El,e("span",zl,a(t(u)),1)]),e("div",Ul,[c(B,{icon:"pi pi-ellipsis-v",rounded:"",class:"h-[32px] w-[32px]",onClick:x}),c(Ve,{ref_key:"menu_selection",ref:I,id:"overlay_menu",model:t(h),popup:!0},null,8,["model"])])])):L("",!0)]),e("div",{class:"h-full border-l transition-all bg-gray-50 flex flex-col overflow-auto",style:G({width:`${t($)}px`})},[e("div",Tl,[c(B,{icon:t(O)?"pi pi-times":"pi pi-sliders-h",text:"",onClick:k[3]||(k[3]=()=>{O.value=!t(O)}),class:"p-0 text-sm h-[30px] w-[30px]"},null,8,["icon"]),t(O)?(l(),i("span",ql," Filtres ")):L("",!0)]),$e(e("div",Nl,[e("div",Ol,[Fl,c(X,{modelValue:t(d).state,"onUpdate:modelValue":k[4]||(k[4]=r=>t(d).state=r),options:t(j),"option-label":"label","option-value":"key",class:"dropdown-sm p-inputtext-sm"},null,8,["modelValue","options"])]),e("div",Bl,[c(B,{icon:"pi pi-plus p-button-sm",label:"Ajouter un filtre",onClick:F,class:"p-0",text:""})]),e("div",Hl,[Zl,c(X,{modelValue:t(d).condition,"onUpdate:modelValue":k[5]||(k[5]=r=>t(d).condition=r),options:t(z),"option-label":"label","option-value":"key",class:"dropdown-sm p-inputtext-sm"},null,8,["modelValue","options"])]),(l(!0),i(H,null,Z(t(T),(r,ie)=>(l(),i("div",{class:"flex flex-col border p-2 rounded mb-2",key:r.id},[e("div",Jl,[c(B,{onClick:U=>De(ie),disabled:t(T).length==1,text:"",icon:"pi pi-times",class:"p-button-sm p-0 h-[20px] w-[20px] p-button-help"},null,8,["onClick","disabled"])]),e("div",Gl,[Wl,c(Le,{placeholder:"Recherche",class:"p-inputtext-sm p-1 mb-2",modelValue:r.search,"onUpdate:modelValue":U=>r.search=U},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Kl,[Ql,c(X,{modelValue:r.search_by,"onUpdate:modelValue":U=>r.search_by=U,options:t(n),class:"dropdown-sm p-inputtext-sm","option-label":"label","option-value":"key"},null,8,["modelValue","onUpdate:modelValue","options"])])]))),128))],512),[[ge,t(O)]])],4),t(C)?(l(),N(Se,{key:0,onRefresh:k[6]||(k[6]=()=>{K()}),prefix_api:E.prefix_api,onClose:k[7]||(k[7]=r=>C.value=!1),pan_id:t(A)},null,8,["prefix_api","pan_id"])):L("",!0)],4)}}},Da=pe(Yl,[["__scopeId","data-v-52c83248"]]);export{Da as default};
