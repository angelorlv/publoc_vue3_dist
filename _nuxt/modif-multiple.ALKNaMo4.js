import E from"./dropdown.esm.PA4Yd-8v.js";import q from"./inputtext.esm.WOKXVyy7.js";import z from"./button.esm.yOU7mbBk.js";import{u as A}from"./useNotifToast.tXbUjrmB.js";import{s as U,G,H,r as p,h as S,q as J,c as l,a as t,d as m,u as o,F as k,D as $,x as C,z as j,b as r,o as n,e as D,A as K,p as O,f as Q}from"./entry.sPeV4ugY.js";import{u as W}from"./global.JfHO2k1E.js";import{_ as X}from"./_plugin-vue_export-helper.x3n3nnut.js";import"./baseicon.esm.7QbvKBS0.js";import"./basecomponent.esm.MS1ObfXz.js";import"./index.esm.y5vHEM8V.js";import"./index.esm.ahttnF-b.js";import"./index.esm.zJBjtqpA.js";import"./index.esm.8qzpe_dP.js";import"./index.esm.Rcv_evjR.js";import"./overlayeventbus.esm.r3x2PMkt.js";import"./portal.esm.HI47vqaC.js";import"./virtualscroller.esm.JbfppkDt.js";import"./badge.esm.4D_NwcJ1.js";const v=h=>(O("data-v-f1cf7634"),h=h(),Q(),h),Y={class:"flex mx-auto w-[900px] border-x"},Z={class:"flex flex-col border-r w-[400px]"},ee={class:"flex flex-col p-2 border-b"},te=v(()=>t("span",{class:"text-sm"}," Régisseur ",-1)),se={class:"flex flex-col p-2 border-b"},oe=v(()=>t("span",{class:"text-sm"}," Recherche référence ",-1)),ae={class:"flex flex-col h-[400px] border-b overflow-auto"},ie={class:"flex flex-col w-[70%]"},le={class:"font-bold"},re={class:"text-gray-400 text-xs"},ne={class:"text-gray-400"},de={class:"flex w-[30%] justify-center items-center px-2"},ce={key:0,class:"flex justify-center items-center p-5"},pe=v(()=>t("span",{class:"text-gray-400 text-sm"}," Aucun panneau trouver. ",-1)),ue=[pe],_e={class:"flex flex-wrap border-y mt-5"},fe=["onClick"],me={class:""},he={key:0,class:"p-5 flex justify-center items-center"},ge=v(()=>t("span",{class:"text-gray-400"}," Pas de régisseurs ",-1)),xe=[ge],ve={key:0,class:"p-2 flex items-center justify-center mt-5"},ye={class:"border-b flex items-center w-full p-2 bg-white sticky top-0"},be={class:"flex items-center flex-grow"},we={class:"p-2 border rounded"},ke={class:"flex group/list flex-col mt-5"},$e={class:"flex flex-col flex-grow"},Ce={class:"flex items-center"},Ve={class:"font-bold flex-grow"},Me={class:"text-gray-400 text-xs"},Se={class:"text-gray-400 text-xs"},je={class:""},De={class:"flex justify-center items-center w-[60px]"},Te={__name:"modif-multiple",props:["heightHeader","prefix_api","heightContainer"],setup(h){const T=W();U(T);const c=h,{setErrorServer:_,setNotifToast:u}=A();G(),H(),p(!1);const g=p([]),d=p([]),y=p(!1),a=p({label:"",reg_id:null}),V=p({1:"Dispo",2:"Dispo",3:"En Location",4:"Indispo"}),b=p([]),w=p([]);async function M(){try{const e=await $fetch(`${c.prefix_api}/a/ad/panel/modif-multiple/data-utils`,{query:{reg_id:a.value.reg_id}});e.status?(d.value=e.list_pan?e.list_pan:[],g.value.length<=0&&(g.value=e.regs,a.value.reg_id=g.value[0].reg_id)):u({detail:e.message,summary:"Récupération des régisseurs",severity:"error"})}catch(e){console.error(e),_()}}S(()=>a.value.label,e=>{f()}),S(()=>a.value.reg_id,e=>{f(),M()});async function I(e){try{const i=await $fetch(`${c.prefix_api}/a/ad/panel/modif-multiple/put-to-list`,{method:"post",body:{pan_id:e,reg_id:a.value.reg_id}});i.status?(u({detail:"Mise à jour de la liste des panneaux bien effectué",summary:"Mise à jour de la liste des panneaux",severity:"success"}),d.value=i.list_pan,f()):u({detail:i.message,summary:"Mise à jour de la liste des panneaux",severity:"error"})}catch(i){console.error(i),_()}}async function L(e){try{const i=await $fetch(`${c.prefix_api}/a/ad/panel/modif-multiple/del-from-list`,{method:"delete",body:{pan_id:e,reg_id:a.value.reg_id}});i.status?(d.value=i.list_pan,f()):u({detail:i.message,summary:"Mise à jour de la liste des panneaux",severity:"error"})}catch(i){console.error(i),_()}}async function R(){try{const e=await $fetch(`${c.prefix_api}/a/ad/panel/modif-multiple/del-all`,{method:"delete",body:{reg_id:a.value.reg_id}});e.status?(d.value=[],f()):u({detail:e.message,summary:"Suppression de la liste",severity:"error"})}catch(e){console.error(e),_()}}async function N(){y.value=!0;try{const e=await $fetch(`${c.prefix_api}/a/ad/panel/modif-multiple/validate`,{method:"put",body:{reg_id:a.value.reg_id}});e.status?(d.value=[],f()):u({detail:e.message,summary:"Validation de la liste",severity:"error"})}catch(e){console.error(e),_()}y.value=!1}async function f(){try{const e=await $fetch(`${c.prefix_api}/a/ad/panel/modif-multiple/search-ref`,{method:"get",query:a.value});e.status?(b.value=e.results,w.value=e.regs_to_modif||[]):u({detail:e.message,summary:"Erreur pendant la recherche",severity:"error"})}catch(e){console.error(e),_()}}return J(()=>{M()}),(e,i)=>{const B=E,F=q,x=z;return n(),l("div",{class:"flex h-full overflow-auto",style:j({height:`${c.heightContainer}px`})},[t("div",Y,[t("div",Z,[t("div",ee,[te,m(B,{modelValue:o(a).reg_id,"onUpdate:modelValue":i[0]||(i[0]=s=>o(a).reg_id=s),class:"p-inputtext-sm",options:o(g),"option-label":"reg_label","option-value":"reg_id",filter:""},null,8,["modelValue","options"])]),t("div",se,[oe,m(F,{modelValue:o(a).label,"onUpdate:modelValue":i[1]||(i[1]=s=>o(a).label=s),class:"p-inputtext-sm"},null,8,["modelValue"])]),t("div",ae,[(n(!0),l(k,null,$(o(b),s=>(n(),l("div",{class:"flex hover:bg-green-300/5 group border-b p-2",key:s.pan_id},[t("div",ie,[t("span",le,[D(r(s.pan_ref)+" - ",1),t("span",re,r(o(V)[s.pan_state]),1)]),t("span",ne,r(s.pan_publoc_ref),1)]),t("div",de,[m(x,{class:"group-hover:flex hidden",onClick:P=>I(s.pan_id),icon:"pi pi-arrow-right",text:"",rounded:"","aria-label":"Filter"},null,8,["onClick"])])]))),128)),o(b).length<=0?(n(),l("div",ce,ue)):C("",!0)]),t("div",_e,[(n(!0),l(k,null,$(o(w),s=>(n(),l("div",{onClick:()=>{o(a).reg_id!=s.reg_id&&(o(a).reg_id=s.reg_id)},class:K([{"bg-blue-300/20 border-0":o(a).reg_id==s.reg_id,"underline cursor-pointer":o(a).reg_id!=s.reg_id},"flex justify-center items-center p-2 m-2 rounded border"]),key:s.reg_id},[t("span",me,r(s.reg_label),1)],10,fe))),128)),o(w).length<=0?(n(),l("div",he,xe)):C("",!0)]),o(d).length>0?(n(),l("div",ve,[m(x,{onClick:N,loading:o(y),label:"Valider la liste",icon:"pi pi-check"},null,8,["loading"])])):C("",!0)]),t("div",{class:"flex flex-col w-full overflow-auto",style:j({height:`${c.heightContainer}px`})},[t("div",ye,[t("div",be,[t("span",we,r(o(d).length)+" panneaux ",1)]),m(x,{disabled:o(d).length<=0,onClick:R,text:"",label:"Supprimer tout",icon:"pi pi-times"},null,8,["disabled"])]),t("div",ke,[(n(!0),l(k,null,$(o(d),s=>(n(),l("div",{class:"flex group/item p-2 first:border-t border-b hover:bg-green-300/5",key:s.pan_id},[t("div",$e,[t("div",Ce,[t("span",Ve,[D(r(s.pan_ref)+" - ",1),t("span",Me,r(o(V)[s.pan_state]),1)]),t("span",Se,r(new Date(s.upanmodif_date).toLocaleDateString())+" - "+r(new Date(s.upanmodif_date).toLocaleTimeString()),1)]),t("span",je,r(s.pan_publoc_ref),1)]),t("div",De,[m(x,{class:"group-hover/item:flex hidden",onClick:P=>L(s.pan_id),icon:"pi pi-times",rounded:"",severity:"danger",text:""},null,8,["onClick"])])]))),128))])],4)])],4)}}},We=X(Te,[["__scopeId","data-v-f1cf7634"]]);export{We as default};
